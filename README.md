# Лабораторная работа №2: дискреционная модель доступа.

Лабораторная работа оценивается в 10 баллов. Каждую «штрафную» неделю вычитается один балл. Лабораторная работа засчитывается только при ответе на все контрольные вопросы. Срок выполнения – 2 недели.

### Реализуйте авторизацию пользователей на основе дискреционной модели доступа. 
Платформа для проведения CTF-соревнований.

При реализации модели следует руководствоваться следующими положениями:

1) Каждый объект является собственностью соответствующего пользователя, который может выполнять над ним определенную совокупность действий в соответствии с заданными правами. Пользователь, являющийся собственником объекта, имеет право передавать часть или все права другим пользователям.

2) Возможный набор прав: Read — чтение, Write — запись, OWN –собственность, TG(tag and grant) — возможность передачи прав.

3) Система должна начинать свою работу с выбора активного пользователя системы, предусматривать выполнение всех необходимых команд для работы с объектами. После операции выбора пользователя системы программа должна выводить на экран список объектов системы, на которых у пользователя есть какие-либо права. Информация о пользователях и об объектах должна храниться в базе данных.
Вначале окно - Выберите пользователя - Введите пароль
Затем показываются файлы.

Информация о пользователях и об объектах должна храниться в базе данных.
```bash
brew install postgresql
pip3 install flask
pip3 install psycopg2-binary
```

```bash
docker run --name db_ctf -p 5432:5432    -e POSTGRES_USER=ctf   -e POSTGRES_PASSWORD=ctf  -e POSTGRES_DB=db_ctf    -e PGDATA=/var/lib/postgresql/data/pgdata    -d -v "$(pwd)/postgres_data":/var/lib/postgresql/data postgres
```

```postgres
-- Create sequence for user ID
CREATE SEQUENCE IF NOT EXISTS userid_seq START WITH 1;

-- Create users table
CREATE TABLE users (
    userid INT PRIMARY KEY DEFAULT nextval('userid_seq'),
    "user" VARCHAR(20) UNIQUE NOT NULL,
    password_hash VARCHAR NOT NULL
);

-- Create sequence for category ID
CREATE SEQUENCE IF NOT EXISTS categoryid_seq START WITH 1;

-- Create categories table
CREATE TABLE categories (
    category_id INT PRIMARY KEY DEFAULT nextval('categoryid_seq'),
    category VARCHAR NOT NULL
);

-- Create sequence for task ID
CREATE SEQUENCE IF NOT EXISTS taskid_seq START WITH 1;

-- Create tasks table
CREATE TABLE tasks (
    task_id INT PRIMARY KEY DEFAULT nextval('taskid_seq'),
    task_name TEXT NOT NULL,
    content TEXT NOT NULL,
    directory VARCHAR
);

-- Create task_categories table (many-to-many relationship)
CREATE TABLE task_categories (
    task_id INT REFERENCES tasks(task_id),
    category_id INT REFERENCES categories(category_id),
    PRIMARY KEY (task_id, category_id)
);

-- Create user_tasks table (many-to-many relationship)
CREATE TABLE user_tasks (
    user_id INT REFERENCES users(userid),
    task_id INT REFERENCES tasks(task_id),
    rights INT NOT NULL,
    PRIMARY KEY (user_id, task_id)
);
```

4) Матрица доступа может быть инициализирована либо случайным образом, либо сформирована отдельно. Число пользователей в системе — 5. Число объектов в системе — 10. Пользователь «номер 1» в системе — Администратор.

Первый пользователь - Администратор
Второй пользователь - Разработчик тасков
Третий пользователь - Разработчик тасков 2
Четвертый пользователь - Участник соревнования
Пятый пользователь - Веб-дизайнер
0b1 - Read
0b10 - Write
0b100 - Execute
0b1000 - Tag and Grant
0b10000 - Own
5 - RX
15 - RWXT
31 - RWXTO

|       | admin | dev1 | dev2 | participant | designer |
| ----- | ----- | ---- | ---- | ----------- | -------- |
| task1 | 15    | 31   | 5    | 5           | 0        |
| task2 | 15    | 31   | 5    | 5           | 0        |
| task3 | 15    | 5    | 31   | 5           | 0        |
| task4 | 15    | 5    | 31   | 5           | 0        |
| task5 | 15    | 5    | 31   | 5           | 0        |
| test1 | 31    | 0    | 0    | 0           | 1        |
| test2 | 31    | 0    | 0    | 0           | 1        |
| test3 | 31    | 0    | 0    | 0           | 1        |
| test4 | 31    | 0    | 0    | 0           | 1        |
| test5 | 31    | 0    | 0    | 0           | 1        |


5) Право TG в матрице заполняется для пользователей либо случайным образом, либо вручную.


6) При создании пользователем Uk объекта Oj пользователь Uk является собственником Oj и имеет на него права R,W, TG. При передаче пользователем Uk права собственности на объект Oj другому пользователю сам пользователь Uk теряет право собственности на этот объект.

Должен быть реализован функционал добавления файлов. При добавлении файлов пользователем он имеет на него все права, кроме X. После передачи остается только R, W, TG

7) Возможность передачи Uk прав R, W на объекты определяется наличием права TG на объекты, права на которые передаются другому пользователю. Возможность передачи Uk права TG на объекты определяется наличием права OWN на объекты, права на которые передаются другому пользователю.

8) Удаление объектов возможно только их собственниками. Пользователь-администратор имеет исключительные полные права на все объекты системы и может оперировать назначением права TG для других пользователей. Пользователь-администратор может создавать в системе других пользователей.

9) В программе должны быть предусмотрены уведомления об успешности выполнения каждого действия (аналогично предусмотреть уведомления о невозможности выполнения действия).

### Проверьте работоспособность системы:

10) Создайте для двух разных пользователей дополнительно 3 объекта в системе. Проследите, как изменилась матрица доступа.

11) Попробуйте выполнить операцию передачи прав на объект от одного пользователя другому пользователю. Проверьте изменения матрицы доступа.

12) Выполните удаление объектов в системе. Проверьте правильность работы системы при удалении объектов. Проверьте изменение матрицы доступа.

### Контрольные вопросы:

13) Что такое политика безопасности (ПБ) и модель ПБ?

14) Дайте определение понятию «авторизация»;

15) Опишите дискреционную модель доступа;

16) Приведите примеры систем, использующих дискреционную модель доступа.